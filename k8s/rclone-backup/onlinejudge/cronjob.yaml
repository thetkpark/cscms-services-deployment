apiVersion: batch/v1
kind: CronJob
metadata:
  name: rclone-sync
  namespace: onlinejudge
spec:
  schedule: "0 21 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: Never
          volumes:
            - name: rclone-config
              secret:
                secretName: rclone-config
                optional: false
            - name: target-vol
              persistentVolumeClaim:
                claimName: oj-pvc
                readOnly: true
          containers:
            - name: rclone
              image: rclone/rclone
              imagePullPolicy: Always
              args:
                - sync
                - /mnt/data
                - cscms-k8s-backup-crypt:onlinejudge
                - --config
                - /config/rclone.conf
                - --log-level
                - INFO
                - --exclude
                - nginx_access.log
              volumeMounts:
                - name: rclone-config
                  mountPath: /config
                  readOnly: false
                - mountPath: /mnt/data
                  name: target-vol
                  readOnly: true
                
